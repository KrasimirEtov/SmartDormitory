@model SensorPartialTableViewModel

@{
    var previousDisabled = Model.CurrentPage == 1 ? "disabled" : string.Empty;
    var nextDisabled = Model.CurrentPage == Model.TotalPages ? "disabled" : string.Empty;
}

<ul class="pagination">
    <li class="page-item">
        <a class="page-link @previousDisabled" id="prevPage" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
            <span class="sr-only">Previous</span>
        </a>
    </li>
    @if (Model.TotalPages > 1)
    {
        @for (int i = 1; i <= Model.TotalPages; i++)
        {
            <li class="page-item @(Model.CurrentPage == i ? "active" : string.Empty)">
                <a onclick="goToPageNumber(this)" data-page-number="@i" class="page-link">
                    @i
                </a>
            </li>
        }
    }
    <li class="page-item">
        <a class="page-link @nextDisabled" id="nextPage" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
            <span class="sr-only">Next</span>
        </a>
    </li>
</ul>

<table class="table table-hover">
    <thead class="thead-dark">
        <tr>
            <th class="h5">Sensor name</th>
            <th class="h5">Owner</th>
            <th class="h5">Sensor type</th>
            <th class="h5">Privacy</th>
            <th class="h5">Alarm</th>
            <th class="h5">Actions</th>
        </tr>
    </thead>
    <tbody class="bg-white">
        @foreach (var sensor in Model.Sensors)
        {
            string privacyIcon = sensor.IsPublic ? "fas fa-globe-americas" : "fas fa-user - secret";
            string privacyColor = sensor.IsPublic ? "text-primary" : "text-warning";
            string alarmIcon = sensor.AlarmOn ? "fas fa-bell" : "far fa-bell";
            string alarmColor = sensor.AlarmOn ? "text-danger" : "";

            <tr>
                <td>@sensor.Name</td>
                <td>@sensor.OwnerUsername</td>
                <td class="text-danger">@sensor.SensorType</td>
                <td class="h3 @privacyColor"><i class="@privacyIcon"></i></td>
                <td class="h3 @alarmColor"><i class="@alarmIcon"></i></td>
                <td>
                    @{
                        string buttonClass = !sensor.IsDeleted ? "btn-danger" : "btn-dark-green";
                        string buttonTitle = sensor.IsDeleted ? "Restore" : "Delete";
                        string glyph = sensor.IsDeleted ? "fas fa-redo" : "far fa-trash-alt";
                    }
                        <form asp-area="Administration" asp-controller="Sensor" class="toggleDeleteForm"
                              asp-action="ToggleDelete" method="post" data-sensor-id="@sensor.Id">
                            <button class="deleteToggleButton d-inline p-2 btn btn-sm waves-effect @buttonClass" type="submit">
                                <i class="icon @glyph"></i> @buttonTitle
                            </button>
                        </form>
                    <div class="d-inline p-2">
                        <i class="fas fa-info"></i> 

                    </div>
                </td>
            </tr>
        }

    </tbody>
</table>

<ul class="pagination">
    <li class="page-item">
        <a class="page-link @previousDisabled" id="prevPage" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
            <span class="sr-only">Previous</span>
        </a>
    </li>
    @if (Model.TotalPages > 1)
    {
        @for (int i = 1; i <= Model.TotalPages; i++)
        {
            <li class="page-item @(Model.CurrentPage == i ? "active" : string.Empty)">
                <a onclick="goToPageNumber(this)" data-page-number="@i" class="page-link">
                    @i
                </a>
            </li>
        }
    }
    <li class="page-item">
        <a class="page-link @nextDisabled" id="nextPage" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
            <span class="sr-only">Next</span>
        </a>
    </li>
</ul>


<script>
    $(function () {
        movePage("#nextPage", @Model.NextPage);
        movePage("#prevPage", @Model.PreviousPage);

        function movePage(tagId, targetPage) {
            $(tagId).click(function () {
                let typeId = $("#MeasureTypeId").val();
                let isPublic = $("#IsPublic").val();
                let alarmSet = $("#AlarmSet").val();
                let url = "@Url.Action("LoadSensorsTable", "Sensor")?measureTypeId=" + typeId +
                  "&isPublic=" + isPublic + "&alarmSet=" + alarmSet + "&page=" + targetPage;
                console.log(url)
                $("#sensorsTable").load(url);
            })
        }

        $('button.deleteToggleButton').click(function () {

            const deleteBtn = 'btn-danger';
            const restoreBtn = 'btn-dark-green';
            const deleteBtnText = '<i class="far fa-trash-alt"></i> Delete';
            const restoreBtnText = '<i class="fas fa-redo"></i> Restore';

            if ($(this).hasClass(deleteBtn)) {
                $(this).removeClass(deleteBtn).addClass(restoreBtn);
                $(this).html(restoreBtnText);
            }
            else if ($(this).hasClass(restoreBtn)) {
                $(this).removeClass(restoreBtn).addClass(deleteBtn);
                $(this).html(deleteBtnText);
            }
        });

        const $toggleDeleteForm = $('.toggleDeleteForm');

        $toggleDeleteForm.on('submit', function (event) {
            event.preventDefault();

            const data = $toggleDeleteForm.serialize();
            const sensorId = $(this).data('sensorId');
            console.log(sensorId)
            const url = $toggleDeleteForm.attr('action') + '?sensorId=' + sensorId;
            console.log(url)
            $.post(url, { __RequestVerificationToken: data.__RequestVerificationToken }, function () {
            });
        });
    });

</script>
